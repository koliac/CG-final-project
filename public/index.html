<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/css/master.css">
    <title>Sound Room</title>
    <script src="/javascipt/M.js"></script>
    <script src="/javascipt/lib2k.js"></script>
    <script src="/javascipt/SHAPE.js"></script>

  </head>
  <body>
    <h1 class="title">Welcome to the sound room</h1>
    <canvas id="canvas1">
    </canvas>
    <script src="/socket.io/socket.io.js"></script>

    <script>
    var socket = io();

    var vs = '\
    attribute vec3 aPos, aNor;\n\
    attribute vec2 aUV;\n\
    varying   vec3 vPos, vNor;\n\
    varying   vec2 vUV;\n\
    uniform   mat4 matrix, invMatrix;\n\
    void main() {\n\
       vec4 pos = matrix * vec4(aPos, 1.);\n\
       vec4 nor = vec4(aNor, 0.) * invMatrix;\n\
       gl_Position = pos;\n\
       vPos = pos.xyz;\n\
       vNor = nor.xyz;\n\
       vUV  = aUV;\n\
    }\n\
    ';

    var fs1 = '\
    varying vec3 vPos, vNor;\n\
    varying vec2 vUV;\n\
    void main() {\n\
       vec3 normal = normalize(vNor);\n\
       vec3 c = vec3(.1,.1,.1);\n\
       c += vec3(.7,.7,1.) * max(0.,dot(normal, vec3( .7, .7, .7)));\n\
       c += vec3(.5,.3,.1) * max(0.,dot(normal, vec3(-.7,-.7,-.7)));\n\
       c*=vec3(1.,.3,.3);\n\
       gl_FragColor = vec4(sqrt(c), 1.);\n\
    }\n\
    ';

    var fs2 = '\
    varying vec3 vPos, vNor;\n\
    varying vec2 vUV;\n\
    uniform sampler2D uSampler;\n\
    void main() {\n\
       vec3 normal = normalize(vNor);\n\
       vec3 c = vec3(.1,.1,.1);\n\
       c += vec3(.7,.7,1.) * max(0.,dot(normal, vec3( .7, .7, .7)));\n\
       c += vec3(.5,.3,.1) * max(0.,dot(normal, vec3(-.7,-.7,-.7)));\n\
       vec4 texture = texture2D(uSampler, vUV);\n\
       c *= texture.rgb;\n\
       gl_FragColor = vec4(sqrt(c), 1.);\n\
    }\n\
    ';

       var obj1, obj2;

       var scene = new Scene();

       var material1 = new Material(vs, fs1);

       var objCount =0;
       obj1 = new SceneObject();
       obj1.setVertices(SHAPE.sphere(60,60));
       obj1.setMaterial(material1);
       scene.addObject(obj1);
       socket.on("connect",function(){
         console.log("New player",socket.id,"just entered");
         socket.emit("spawn");

       });




       canvas1.scene = scene;

       var m = M.identityMatrix();

    gl_start(canvas1,
       function(time) {
          M.identity(m);

          M.save(m);
           M.translate(m,[0,0,-.8]);
            M.scale(m, .2);

             obj1.setMatrix(m);
          M.restore(m);


       }
    );

    </script>
  </body>
</html>
